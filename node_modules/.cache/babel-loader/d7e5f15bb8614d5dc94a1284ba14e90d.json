{"ast":null,"code":"/**\n * Treasure Global ID\n */\n// Modules\nvar jsonp = require('jsonp');\n\nvar invariant = require('../utils/misc').invariant;\n\nvar noop = require('../utils/misc').noop;\n\nvar cookie = require('../vendor/js-cookies');\n\nfunction cacheSuccess(result, cookieName) {\n  cookie.setItem(cookieName, result['global_id'], 6000);\n  return result['global_id'];\n}\n\nfunction configure() {}\n\nfunction fetchGlobalID(success, error, forceFetch) {\n  success = success || noop;\n  error = error || noop;\n  var cookieName = this.client.globalIdCookie;\n  var cachedGlobalId = cookie.getItem(this.client.globalIdCookie);\n\n  if (cachedGlobalId && !forceFetch) {\n    return setTimeout(function () {\n      success(cachedGlobalId);\n    }, 0);\n  }\n\n  var url = 'https://' + this.client.host + '/js/v3/global_id';\n  invariant(this.client.requestType === 'jsonp', 'Request type ' + this.client.requestType + ' not supported');\n  jsonp(url, {\n    prefix: 'TreasureJSONPCallback',\n    timeout: 10000 // 10 seconds timeout\n\n  }, function (err, res) {\n    return err ? error(err) : success(cacheSuccess(res, cookieName));\n  });\n}\n\nmodule.exports = {\n  cacheSuccess: cacheSuccess,\n  configure: configure,\n  fetchGlobalID: fetchGlobalID\n};","map":null,"metadata":{},"sourceType":"script"}